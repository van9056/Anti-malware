package antimalware;

import antimalware.database.Database;
import antimalware.database.FileSystemGateway;
import antimalware.database.IDatabase;
import antimalware.database.IFileSystemGateway;
import antimalware.scanner.*;

import java.io.*;
import java.nio.ByteBuffer;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class AntiMalware {

    private static final String DIRECTORY_NAME = "AMDB";
    private static final File DATABASE_DIRECTORY =
            new File(System.getProperty("user.home") + File.separator + DIRECTORY_NAME);
    private static final String DATABASE_FILE_HEADER = "Prokopchuk";

    public static void main(String[] args) throws FileNotFoundException {
        IFileSystemGateway fileSystemGateway = new FileSystemGateway(DATABASE_DIRECTORY, DATABASE_FILE_HEADER);
        IDatabase database = new Database(fileSystemGateway);

        //Тест работоспособности ScanObject'ов. Результат: тест прошел успешно.
        /*
        IObjectContent objectContent = new IObjectContent() {

            File file = new File("C:\\Users\\van90\\Desktop\\test3");
            FileInputStream fin = new FileInputStream(file);

            @Override
            public long getSize() {
                return file.length();
            }

            @Override
            public int readBlock(int offset, byte[] block) {
                if (fin == null) {
                    try {
                        fin = new FileInputStream(file);
                    } catch (FileNotFoundException e) {
                        e.printStackTrace();
                    }
                }
                try {
                    //return fin.read(block);
                    BufferedInputStream bis = new BufferedInputStream(fin, block.length);
                    bis.skip(offset);
                    return bis.read(block);
                } catch (IOException e) {
                    e.printStackTrace();
                }
                return 0;
            }
        };

        List<ScanRegion> regions = new ArrayList<>();
        ScanRegion scanRegion = new ScanRegion(objectContent, 0, (int) objectContent.getSize(), 512);
        regions.add(scanRegion);
        ScanObject scanObject = new ScanObject(objectContent, regions, null);

        ScanRegion sr;
        while ((sr = scanObject.nextScanRegion()) != null) {
            do {
                byte[] block = sr.read();
                if (block != null && block.length > 0) {
                    System.out.print(new String(block));
                } else {
                    break;
                }
            } while (true);
        }*/
    }
}
