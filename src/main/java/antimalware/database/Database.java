package antimalware.database;

import antimalware.database.data.Suspect;

import java.nio.ByteBuffer;
import java.util.*;

public class Database implements IDatabase {

    private IFileSystemGateway fileSystemGateway;
    private TreeMap<ByteBuffer, List<Suspect>> db = new TreeMap<>();

    public Database(IFileSystemGateway fileSystemGateway) {
        this.fileSystemGateway = fileSystemGateway;
        initialize();

        // Выводит все проинициализированные записи в базе данных
        /*for (ByteBuffer bytes : db.keySet()) {
            List<Suspect> suspects = db.get(bytes);
            for (Suspect suspect : suspects) {
                System.out.println(suspect.getSignature());
            }
        }*/
    }

    private void initialize() {
        List<Suspect> suspects = fileSystemGateway.readSuspects();
        if (suspects != null) {
            for (Suspect suspect : suspects) {
                add(suspect);
            }
        }
    }

    // Поиск по префиксу сигнатуры
    @Override
    public List<Suspect> search(ByteBuffer signBytes) {
        if (db.containsKey(signBytes)) {
            return db.get(signBytes);
        }
        return null;
    }

    @Override
    public void add(Suspect suspect) {
        db.put(ByteBuffer.wrap(suspect.getSignature().getSignBytes()), new ArrayList<>(Arrays.asList(suspect)));
    }
}
