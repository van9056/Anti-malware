package antimalware.database;

import antimalware.database.data.Suspect;

import java.lang.reflect.Array;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.TreeMap;

public class Database implements IDatabase {

    private IFileSystemGateway fileSystemGateway;
    private HashMap<byte[], Suspect> db = new HashMap<>(); //TODO: Реализовать TreeMap и сортировку для suspect'ов

    public Database(IFileSystemGateway fileSystemGateway) {
        this.fileSystemGateway = fileSystemGateway;
        initialize();

        //TODO: (Убрать) Выводит все проинициализированные записи в базе данных
        for (byte[] bytes : db.keySet()) {
            System.out.println(Arrays.toString(bytes) + " : " + db.get(bytes).getName());
        }
    }

    private void initialize() {
        List<Suspect> suspects = fileSystemGateway.readSuspects();
        if (suspects != null) {
            for (Suspect suspect : suspects) {
                db.put(suspect.getSignature().getSignBytes(), suspect);
            }
        } else {
            //TODO: print("Ошибка инициализации дазы данных!")
        }
    }

    @Override
    public Suspect search(byte[] signBytes) {
        return db.get(signBytes);
    }

    @Override
    public void add(Suspect suspect) {
        db.put(suspect.getSignature().getSignBytes(), suspect);
    }
}
