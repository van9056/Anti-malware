package antimalware.database;

import antimalware.database.data.Suspect;

import java.nio.ByteBuffer;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.TreeMap;

public class Database implements IDatabase {

    private IFileSystemGateway fileSystemGateway;
    private TreeMap<ByteBuffer, Suspect> db = new TreeMap<>();

    public Database(IFileSystemGateway fileSystemGateway) {
        this.fileSystemGateway = fileSystemGateway;
        initialize();

        //TODO: Временный вывод (для отладки). Выводит все проинициализированные записи в базе данных
        for (ByteBuffer bytes : db.keySet()) {
            System.out.println(Arrays.toString(bytes.array()) + " : " + db.get(bytes).getName());
        }
    }

    private void initialize() {
        List<Suspect> suspects = fileSystemGateway.readSuspects();
        if (suspects != null) {
            for (Suspect suspect : suspects) {
                add(suspect);
            }
        } else {
            //TODO: print("Ошибка инициализации дазы данных!")
        }
    }

    @Override
    public Suspect search(byte[] signBytes) {
        return db.get(signBytes);
    }

    @Override
    public void add(Suspect suspect) {
        db.put(ByteBuffer.wrap(suspect.getSignature().getSignBytes()), suspect);
    }
}
