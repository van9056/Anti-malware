package antimalware.scanner;

public class ScanRegion {

    private IObjectContent objectContent;   // Абстракция содержимого для сканирования
    private int blockSize = 512;      // Размер блока в байтах для чтения заданного региона
    private int size;       // Размер сегмента
    private int offset;     // Смещение относительно начала контента
    private int localOffset = 0;    // Локальное смещение для последовательного чтения блоков байт

    //TODO: Добавить ещё один конструктор с параметром blockSize по умолчанию (512 байт)
    public ScanRegion(IObjectContent objectContent, int offset, int size, int blockSize) {
        this.objectContent = objectContent;
        this.offset = offset;
        //TODO: Реализовать проверку на корректность размера региона (При чтении может выходить за пределы файла)
        this.size = size;
        if (blockSize > 0) {
            this.blockSize = blockSize;
        }
    }

    public byte[] read() {
        //TODO: Переделать чтение с помощью readBlock(). Использовать другой offset
        if ((localOffset + blockSize) <= size) {
            byte[] block = new byte[blockSize];
            localOffset += objectContent.readBlock(block.length, block);
            return block;
        } else if ((size - localOffset) > 0) {
            byte[] block = new byte[size - localOffset];
            localOffset += objectContent.readBlock(block.length, block);
            return block;
        }
        return null;
    }
}
