package antimalware.scanner;

import java.io.IOException;
import java.nio.ByteBuffer;

public class ScanRegion {

    private IObjectContent objectContent;   // Абстракция содержимого для сканирования
    private int blockSize = 4096;      // Размер блока в байтах для чтения заданного региона
    private int size = 0;       // Размер сегмента
    private int offset;     // Смещение относительно начала контента
    private int localOffset = 0;    // Локальное смещение для последовательного чтения блоков байт

    //TODO: Добавить ещё один конструктор с параметром blockSize по умолчанию (4096 байт)
    public ScanRegion(IObjectContent objectContent, int offset, int size, int blockSize) {
        this.objectContent = objectContent;
        this.offset = offset;
        if (blockSize > 0) {
            this.blockSize = blockSize;
        }
        if (size > 0 && (offset + size) <= objectContent.getSize()) {
            this.size = size;
        } else {
            //TODO: print("Ошибка: Введен некорректный size!");
        }
    }

    public byte[] read() {
        if ((localOffset + blockSize) <= size) {
            ByteBuffer block = ByteBuffer.allocate(blockSize);
            localOffset += objectContent.readBlock(offset + localOffset, block);
            byte[] result = block.array();
            block.clear();
            return result;
        } else if ((size - localOffset) > 0) {
            ByteBuffer block = ByteBuffer.allocate(size - localOffset);
            localOffset += objectContent.readBlock(offset + localOffset, block);
            byte[] result = block.array();
            block.clear();
            return result;
        }
        return null;
    }
}
