package antimalware.scanner;

import java.util.ArrayList;
import java.util.List;

public class PEScanObjectBuilder {

    private final String HEADER = "MZ";      // Заголовок PE файла
    private IObjectContent objectContent;

    public PEScanObjectBuilder(IObjectContent objectContent) {
        this.objectContent = objectContent;
    }

    public ScanObject getScanObject() {
        byte[] headerBytes = new byte[2];
        objectContent.readBlock(0, headerBytes);
        String header = new String(headerBytes);
        if (header.equals(HEADER)) {
            //TODO: Временная реализация... Берем в качестве ScanRegion весь файл
            ScanRegion scanRegion = new ScanRegion(objectContent, 0, (int) objectContent.getSize(), 512);
            List<ScanRegion> regions = new ArrayList<>();
            regions.add(scanRegion);
            ScanObject scanObject = new ScanObject(objectContent, regions, null);
            return scanObject;
        }
        return null;
    }

    private ScanRegion getCodeSegment() {
        //TODO: Реализовать поиск .text сегмента
        return null;
    }

    private ScanRegion getDataSegment() {
        //TODO: Реализовать поиск .data сегмента
        return null;
    }
}
